# 商店交易系统使用说明

## 概述

商店交易系统允许玩家将背包中的物品典当，获得健康值。系统包含两个脚本：

1. **ShopTrade.cs** - 完整的商店交易系统，包含UI管理和确认面板
2. **ShopTradeButton.cs** - 简化的交易按钮脚本，专门用于按钮点击事件

## 快速使用（推荐）

### 方法1：使用简化脚本（ShopTradeButton.cs）

1. **创建脚本组件**：
   - 在Shop场景中创建一个空的GameObject
   - 添加 `ShopTradeButton` 脚本组件

2. **设置按钮**：
   - 在Unity编辑器中，选择你的交易按钮
   - 在Button组件的OnClick事件中：
     - 点击 "+" 添加新事件
     - 将包含 `ShopTradeButton` 脚本的GameObject拖拽到对象栏
     - 在函数下拉菜单中选择 `ShopTradeButton → ExecuteTrade()`

3. **测试功能**：
   - 在Inspector中选中 `ShopTradeButton` 组件
   - 右键选择 "显示交易信息" 查看当前状态
   - 右键选择 "测试交易" 进行测试

### 方法2：使用完整脚本（ShopTrade.cs）

1. **创建脚本组件**：
   - 在Shop场景中创建一个空的GameObject
   - 添加 `ShopTrade` 脚本组件

2. **设置UI组件**：
   - **交易按钮**：拖拽交易按钮到 `Trade Button` 字段
   - **按钮文本**：拖拽按钮的Text组件到 `Trade Button Text` 字段
   - **确认面板**：拖拽确认面板GameObject到 `Confirmation Panel` 字段
   - **确认文本**：拖拽确认面板中的Text组件到 `Confirmation Text` 字段
   - **确认按钮**：拖拽确认按钮到 `Confirm Button` 字段
   - **取消按钮**：拖拽取消按钮到 `Cancel Button` 字段

3. **配置设置**：
   - **Show Debug Info**：是否显示调试信息
   - **Show Trade Confirmation**：是否显示交易确认面板
   - **Trade Button Default Text**：交易按钮默认文本
   - **Trade Button Empty Text**：背包为空时的按钮文本

## 功能特性

### 自动更新按钮状态
- 按钮会根据背包状态自动启用/禁用
- 按钮文本会显示当前可交易的物品数量和健康值

### 交易确认
- 可选择是否显示交易确认面板
- 确认面板显示详细的交易信息

### 数据同步
- 自动同步数据到GameDataManager
- 确保场景切换时数据保持一致

### 错误处理
- 检查Inventory和Player实例是否存在
- 检查背包是否为空
- 提供详细的错误信息

## 交易流程

1. **检查条件**：
   - Inventory实例存在
   - Player实例存在
   - 背包不为空

2. **计算交易**：
   - 获取背包中所有物品的健康值总和
   - 计算交易后的健康值

3. **执行交易**：
   - 将物品健康值加到玩家健康值上
   - 清空背包
   - 同步数据到GameDataManager

4. **显示结果**：
   - 在控制台显示交易结果
   - 更新UI状态

## 调试功能

### ShopTradeButton 调试功能
- **显示交易信息**：在控制台显示当前交易状态
- **测试交易**：执行一次完整的交易流程

### ShopTrade 调试功能
- **显示交易信息**：在控制台显示当前交易状态
- **测试交易**：执行一次完整的交易流程
- **实时UI更新**：按钮状态和文本实时更新

## 示例物品健康值

根据ItemManager中的设置：
- 项链：100健康值
- 猫：50健康值
- 植物：30健康值
- 茶壶：80健康值

## 注意事项

1. **确保单例存在**：确保场景中有Inventory和Player的单例实例
2. **数据同步**：交易后会自动同步数据，无需手动处理
3. **UI更新**：如果使用完整脚本，UI会自动更新
4. **错误处理**：系统会检查各种错误情况并提供相应提示

## 故障排除

### 常见问题

1. **"Inventory实例未找到"**
   - 确保场景中有Inventory组件
   - 检查Inventory是否正确设置为单例

2. **"Player实例未找到"**
   - 确保场景中有Player组件
   - 检查Player是否正确设置为单例

3. **"背包为空，无法进行交易"**
   - 这是正常提示，表示当前没有可交易的物品
   - 需要先收集物品才能进行交易

4. **按钮不响应**
   - 检查按钮的OnClick事件是否正确设置
   - 确保拖拽了正确的GameObject和函数

### 调试步骤

1. 启用 `Show Debug Info`
2. 使用 "显示交易信息" 功能查看当前状态
3. 检查控制台输出的错误信息
4. 使用 "测试交易" 功能验证系统是否正常工作 